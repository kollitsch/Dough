/*
* Dough, A Cookie Plugin for jQuery
* By: Nathan Searles, http://nathansearles.com
* Example: http://nathansearles.com/plugin/dough
* Version: 1.1
* Updated: April 20th, 2011
*
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function($){$.dough=function(a,b,c){c=$.extend({},$.dough.option,c);var d=c.expires;if(b===undefined){var e=document.cookie.match(a+'=([^;]*)(;|$)');if(e){if(e[1][0]=='['){return $.parseJSON(e[1])[0]}else{return e[1]}}else{return}}if(b=='remove'){d=-1;b=''}var f=a+'='+b;if(d){var g=new Date();g.setTime(g.getTime()+(d*24*60*60*1000));f+='; expires='+g.toUTCString()}if(c.path=='current'){f+=';'}else{f+='; path='+c.path+';'}if(c.domain){if(c.domain=='auto'){var h=document.domain.match(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g),domainName='.'+document.domain;var i=h?h.toString():domainName.toString();f+='; domain='+i+';'}else{f+='; domain='+c.domain+';'}}if(c.secure){f+='; secure'}document.cookie=f};$.dough.option={expires:false,path:'/',domain:false,secure:false,json:true}})(jQuery);(function($){var i={y:0,elastic:true,momentum:true,elasticDamp:0.6,elasticTime:50,reboundTime:400,momentumDamp:0.9,momentumTime:300,iPadMomentumDamp:0.95,iPadMomentumTime:1200};var j={init:function(h){return this.each(function(){var $this=$(this),o=$.extend(i,h),scrollY=-o.y,touchY=0,movedY=0,pollY=0,height=0,maxHeight=0,scrollHeight=$this.attr('scrollHeight'),scrolling=false,bouncing=false,moved=false,timeoutID,isiPad=navigator.platform.indexOf('iPad')!==-1,hasMatrix='WebKitCSSMatrix'in window,has3d=hasMatrix&&'m11'in new WebKitCSSMatrix();var f=this.update=function(){height=$this.height();scrollHeight=$this.attr('scrollHeight');maxHeight=height-scrollHeight;clearTimeout(timeoutID);clampScroll(false)};f();$this.css({'-webkit-transition-property':'-webkit-transform','-webkit-transition-timing-function':'cubic-bezier(0, 0, 0.2, 1)','-webkit-transition-duration':'0','-webkit-transform':cssTranslate(scrollY)});window.addEventListener('onorientationchange'in window?'orientationchange':'resize',f,false);$this.bind('touchstart.touchScroll',touchStart);$this.bind('touchmove.touchScroll',touchMove);$this.bind('touchend.touchScroll touchcancel.touchScroll',touchEnd);$this.bind('webkitTransitionEnd.touchScroll',transitionEnd);var g=this.setPosition=function(y){scrollY=y;$this.css('-webkit-transform',cssTranslate(scrollY))};function cssTranslate(y){return'translate'+(has3d?'3d(0px, ':'(0px, ')+y+'px'+(has3d?', 0px)':')')}function setTransitionTime(a){a=a||'0';$this.css('-webkit-transition-duration',a+'ms')}function getPosition(){if(hasMatrix){var a=new WebKitCSSMatrix(window.getComputedStyle($this[0]).webkitTransform);return a.f}return scrollY}this.getPosition=function(){return getPosition()};function reboundScroll(){if(scrollY>0){scrollTo(0,o.reboundTime)}else if(scrollY<maxHeight){scrollTo(maxHeight,o.reboundTime)}}function transitionEnd(){if(bouncing){bouncing=false;reboundScroll()}clearTimeout(timeoutID)}function clampScroll(a){if(!hasMatrix||bouncing){return}var b=pollY;pollY=getPosition();if(pollY>0){if(o.elastic){bouncing=true;scrollY=0;momentumScroll(pollY-b,o.elasticDamp,1,height,o.elasticTime)}else{setTransitionTime(0);g(0)}}else if(pollY<maxHeight){if(o.elastic){bouncing=true;scrollY=maxHeight;momentumScroll(pollY-b,o.elasticDamp,1,height,o.elasticTime)}else{setTransitionTime(0);g(maxHeight)}}else if(a){timeoutID=setTimeout(clampScroll,20,true)}}function scrollTo(a,b){if(a===scrollY){return}moved=true;setTransitionTime(b);g(a)}function momentumScroll(d,k,a,b,t){var c=Math.abs(d),dy=0;while(c>0.1){c*=k;dy+=c}if(dy>b){dy=b}if(dy>a){if(d<0){dy=-dy}scrollTo(scrollY+Math.round(dy),t)}clampScroll(true)}function getTouches(e){if(e.originalEvent){if(e.originalEvent.touches&&e.originalEvent.touches.length){return e.originalEvent.touches}else if(e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length){return e.originalEvent.changedTouches}}return e.touches}function touchStart(e){if(e.target.tagName!="SELECT"){e.preventDefault();e.stopPropagation();var a=getTouches(e);scrolling=true;moved=false;movedY=0;clearTimeout(timeoutID);setTransitionTime(0);if(o.momentum){var y=getPosition();if(y!==scrollY){g(y);moved=true}}touchY=a[0].pageY-scrollY}}function touchMove(e){if(!scrolling){return}var a=getTouches(e),dy=a[0].pageY-touchY;if(dy>0){if(o.elastic){dy/=2}else{dy=0}}else if(dy<maxHeight){if(o.elastic){dy=(dy+maxHeight)/2}else{dy=maxHeight}}movedY=dy-scrollY;moved=true;g(dy)}function touchEnd(e){if(!scrolling){return}scrolling=false;var a=getTouches(e);if(moved){if(scrollY>0||scrollY<maxHeight){reboundScroll()}else if(o.momentum){momentumScroll(movedY,isiPad?o.iPadMomentumDamp:o.momentumDamp,40,2000,isiPad?o.iPadMomentumTime:o.momentumTime)}}else{var b=a[0],target=b.target,me=document.createEvent('MouseEvent');while(target.nodeType!==1){target=target.parentNode}me.initMouseEvent('click',true,true,b.view,1,b.screenX,b.screenY,b.clientX,b.clientY,false,false,false,false,0,null);target.dispatchEvent(me)}}})},update:function(){return this.each(function(){this.update()})},getPosition:function(){var a=[];this.each(function(){a.push(-this.getPosition())});return a},setPosition:function(y){return this.each(function(){this.setPosition(-y)})}};$.fn.touchScroll=function(a){if(j[a]){return j[a].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof a==='object'||!a){return j.init.apply(this,arguments)}else{$.error('Method '+a+' does not exist on jQuery.touchScroll')}}})(jQuery);
